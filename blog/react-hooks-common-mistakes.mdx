---
title: 'React Hooks. Распространенные ошибки которые следует избегать'
date: '2022-01-04'
---

import Gist from 'react-gist';

<p>
  React Hooks были впервые представлены в обновление React 16.8 и стали популярны среди
  разработчиков благодаря своим возможностям. Они позволяют менять состояние и реагировать
  на жизненный цикл компонента. Но давайте углубляться…
</p>

<p className="mt-8">
  В этой статье, я бы хотел обсудить 5 распространенных ошибок, которые должен избегать
  каждый разработчик.
</p>

<h2 class="mt-8 mb-8 font-bold text-4xl text-sky-600">1. Хук должен выполняться сразу</h2>

<p class="mt-8 mb-8">
  Хуки не должны быть вызваны внутри циклов или условиях, так как в определенных случаях
  выполняемые хуки могут вызвать неожиданные ошибки.
</p>

<p class="mt-8 mb-8">
  Избежание таких ситуаций гарантирует, что хуки будут вызываться в правильном порядке
  каждый раз при рендеринге компонента.
</p>

<p class="mt-8 mb-8">
  Ниже я создал обычный React компонент, чтобы выбрать пользователя и отобразить его
  данные.
</p>

<div>
  <Gist id="e5fc194641b2fc8a031a07b38fedea99" />
</div>

<p class="mt-8 mb-8">
  На первый взгляд всё кажется нормально, но открыв консоль получаем ошибку.
</p>

<p class="mt-8 mb-8">
  Чтобы избежать этого, вы можете просто переместить оператор return после вызова хуков.
</p>

<p class="mt-8 mb-8">
  Итак, не забывайте использовать хуки перед любым return на верхнем уровне вашего
  компонента React
</p>

<div>
  <Gist id="1320a01b4350988f5823b833f1f6dd8a" />
</div>

<h2 class="mt-8 mb-8 font-bold text-4xl text-sky-600">
  2. Использовать useState когда ре-рендер компоненты не требуется
</h2>

<p class="mt-8 mb-8">
  В функциональных компонента, вы можете использовать хук useState для обработки состояния
  и это довольно просто, но при неправильном использовании могут возникнуть непредвиденные
  проблемы.
</p>

<p class="mt-8 mb-8">
  Например, предположим у нас есть компонент с двумя кнопками. Первая кнопка будет
  триггерить счётчик, а вторая кнопка будет выполнять запрос на основе текущего состояния
  счётчика.
</p>

<div>
  <Gist id="f8732b86bb2f61dcb53ba9558af03f00" />
</div>

<p class="mt-8 mb-8">
  Код выше будет работать нормально, но поскольку мы не использовали состояние на этапе
  рендеринга, при каждом нажатии кнопки счётчика будут возникать нежелательные повторные
  рендеры.
</p>

<p class="mt-8 mb-8">
  Итак, если вам нужно использовать переменную внутри компонента, которая сохраняет своё
  состояние при ре-рендеринге, то useRef будет лучшим вариантом.
</p>

<div>
  <Gist id="7c809f65154a06b11dc7e8a4bf4c3853" />
</div>

<h2 class="mt-8 mb-8 font-bold text-4xl text-sky-600">
  3. Обработка действий с помощью useEffect
</h2>

<p class="mt-8 mb-8">
  Хук useEffect – один из самых крутых методов для обработки задач, связанных с
  изменениями props или состояния компонента. Но могут быть ситуации, когда это ещё больше
  усложняет ситуацию.
</p>

<p class="mt-8 mb-8">
  Предположим, есть компонент, который принимает список данных и отображает его в DOM.
</p>

<div>
  <Gist id="f9b63ec7d7e768bf264ecfc030ff78d0" />
</div>

<p class="mt-8 mb-8">
  Первый useEffect хук обрабатывает вызов некого apiCall() при первым рендере. Если все
  условия выполнены, второй useEffect вызовет функцию onSuccess()
</p>

<p class="mt-8 mb-8">
  Однако прямой связи между действиями и вызванной функции нет. По этому мы не может
  гарантировать, что всё пойдёт по сценарию.
</p>

<p class="mt-8 mb-8">
  Чтобы исправить ситуацию, мы должны переместить функцию onSuccess() внутрь функции
  apiCall() и нам уже не придётся использовать отдельный хук useEffect
</p>

<div>
  <Gist id="ee60972364f0d9059a0d43829ea3dd9d" />
</div>

<h2 class="mt-8 mb-8 font-bold text-4xl text-sky-600">
  4. Использование устаревшего состояния
</h2>

<p class="mt-8 mb-8">
  Если вы измените состояние несколько раз в последующих строках кода, результаты могут
  вас удивить
</p>

<div>
  <Gist id="144e6b46c15a3f15fe6aeafc980d214b" />
</div>

<p class="mt-8 mb-8">
  В примере выше компонент Counter увеличивает значение count. Поскольку компонента
  вызывает функции setCount() 3 раза, вы можете подумать, что одно нажатие кнопки увеличит
  значение счётчика на 3. Но при каждом нажатии оно будет увеличиться только на 1.
</p>

<p class="mt-8 mb-8">
  Первоначальный вызов setCount(count + 1) увеличит счётчик соответствующим образом, так
  как count + 1 = 0 + 1 = 1. Точно так же следующие два вызова setCount(count + 1) также
  установят счётчик на 1, поскольку используется устаревшее состояние.
</p>

<p class="mt-8 mb-8">
  Эту проблему можно решить, обновив состояние с помощью функционального подхода.
</p>

<div>
  <Gist id="b31cc8c1e34f19065a96a52e4ed9f49e" />
</div>

<h2 class="mt-8 mb-8 font-bold text-4xl text-sky-600">
  5. Отсутствие зависимостей useEffect
</h2>

<p class="mt-8 mb-8">
  useEffect – один из наиболее часто используемых хуков в React, и по умолчанию он всегда
  запускается при каждом повторном рендеринге. Однако такое поведение может вызвать
  проблемы с производительностью.
</p>

<p class="mt-8 mb-8">
  Мы можем избежать нежелательного рендеринга компонента передав массив зависимостей в
  useEffect. Данный хук принимает массив зависимостей в качестве второго параметра и
  гарантирует, что этот эффект будет выполняться только в том случае, если элементы в
  массиве изменяются при повторном рендеринге
</p>

<div>
  <Gist id="2d57fb65eca83e80f300281598e17172" />
</div>

<p class="mt-8 mb-8">
  Рассмотрим следующий пример. На первый взгляд кажется, что это нормальное работающее
  решение.
</p>

<div>
  <Gist id="16ff34222ae3002a8dfcc6a23c1b04a6" />
</div>

<p class="mt-8 mb-8">
  Но есть проблема, и вы можете найти предупреждение в консоли DevTools.
</p>

<p class="mt-8 mb-8">
  Чтобы исправить это, вам необходимо убедиться, что массив содержит все значения
  зависимостей в пределах области компонента, которые могут изменяться со временем и
  используются эффектом.
</p>

<p class="mt-8 mb-8">
  В противном случае ваш код будет использовать значения из предыдущих визуализаций,
  которые больше не действительны.
</p>

<div>
  <Gist id="50083638f8d46636da47641f49d6775e" />
</div>

<h2 class="mt-8 mb-8 font-bold text-4xl text-sky-600">Финальные мысли</h2>

<p class="mt-8 mb-8">
  Хуки – это простые и понятные функции многократного использования, которые можно
  включить в ваш рабочий процесс. Кроме того, они предлагают нам множество вариантов для
  разнообразного использования, поэтому нам не нужно создавать их с нуля.
</p>

<p class="mt-8 mb-8 ">
  Автор: <span className="text-sky-600">Piumi Liyana Gunawardhana</span>
</p>
<div>
  Ссылка на оригинал:{' '}
  <a
    className="text-sky-600"
    href="https://blog.bitsrc.io/common-react-hooks-mistakes-every-developer-should-avoid-defd47d09d8c"
    target="_blank">
    blog.bitsrc.io
  </a>
</div>
